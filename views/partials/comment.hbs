{{!-- views/partials/comment.hbs --}}
<div class="comment-box mb-3" style="position: relative; margin-left: 1.5rem;">
  <p>
    <strong>{{comment.author}}</strong>
    <small class="text-muted">{{comment.timestamp}}</small>
  </p>
  <p>{{comment.text}}</p>

  <!-- Voting Section -->
  <div class="d-flex align-items-center">
    <form action="/post/{{@root.postIndex}}/comment/reply" method="POST" style="margin-right: 8px;">
      <input type="hidden" name="path" value="{{path}}">
      <input type="hidden" name="action" value="upvoteNested">
      <button class="btn btn-sm btn-outline-success" type="submit">↑</button>
    </form>
    <span class="mx-2 fw-bold">{{comment.votes}}</span>
    <form action="/post/{{@root.postIndex}}/comment/reply" method="POST" style="margin-left: 8px;">
      <input type="hidden" name="path" value="{{path}}">
      <input type="hidden" name="action" value="downvoteNested">
      <button class="btn btn-sm btn-outline-danger" type="submit">↓</button>
    </form>
  </div>

  <!-- Edit and Delete Buttons (visible only to the comment's author) -->

  
  {{#if (eq comment.author @root.user.username)}}
    <div style="position: absolute; top: 5px; right: 5px; display: flex; gap: 5px;">
      
      <!-- This is also used as the conditionally shown edit button -->
      <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-toggle="collapse" data-bs-target="#editComment-{{path}}">
        Edit
      </button>
      <form method="POST" action="/post/{{@root.postIndex}}/comment/{{@index}}/delete" style="margin: 0;">
        <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
      </form>
    </div>
    <div class="collapse mt-2" id="editComment-{{path}}">
      <form method="POST" action="/post/{{@root.postIndex}}/comment/{{@index}}/edit">
        <textarea class="form-control" name="commentText" rows="2" required>{{comment.text}}</textarea>
        <button type="submit" class="btn btn-sm btn-primary mt-2">Save Changes</button>
      </form>
    </div>
  {{/if}}

  <!-- Reply Toggle -->
  <div class="mt-2">
    <button type="button" class="btn btn-sm btn-outline-info" data-bs-toggle="collapse" data-bs-target="#replyForm-{{path}}">
      Reply
    </button>
  </div>

  <!-- Reply Form -->
  <div class="collapse mt-2" id="replyForm-{{path}}">
    <form method="POST" action="/post/{{@root.postIndex}}/comment/reply">
      <input type="hidden" name="path" value="{{path}}">
      <div class="mb-2">
        <textarea class="form-control" name="replyText" rows="2" placeholder="Write your reply..." required></textarea>
      </div>
      <div class="d-flex justify-content-end">
        <button type="submit" class="btn btn-sm btn-primary">Post Reply</button>
      </div>
    </form>
  </div>

  <!-- Recursive Nested Replies -->
  {{#if comment.replies}}
    {{#if comment.replies.length}}
      <div class="ms-4 mt-3">
        {{#each comment.replies as |childReply|}}
          {{> comment
              comment=childReply
              postIndex=@root.postIndex
              path=childReply.path
          }}
        {{/each}}
      </div>
    {{/if}}
  {{/if}}
</div>
